---
- name: misc packages
  hosts: all
  become: yes
  tasks:
    - action: apt_repository
      name: Add apt repositories
      args:
        repo: "{{item}}"
      with_items:
        #- ppa:ubuntu-wine/ppa
        - ppa:hluk/copyq
        #- ppa:leolik/leolik # notify-osd fork # doesn't have ardwark yet

    - action: apt
      args:
        update_cache: yes

    - action: apt
      args:
        name: "{{item}}"
      with_items:

        # Libraries
        - libgtk-3-dev # For building themes

        #
        - blueman # bluetooth applet
        - feh # Desktop background
        - notify-osd
        - redshift # screen color temperature
        - xfce4-power-manager
        - xfce4-screenshooter-plugin

        # System tools
        - baobab
        - copyq
        - dconf-gsettings-backend
        - dconf-service
        - gparted
        - gsettings-desktop-schemas
        - gsettings-ubuntu-schemas
        - lightdm
        - light-locker
        - nautilus-dropbox
        - network-manager-openvpn-gnome
        - pavucontrol
        - python-pip
        - suckless-tools
        - synaptic
        - terminator

        # Applications
        - eog
        - evince # pdf reader
        - filezilla
        - firefox
        - gimp
        - gnome-calculator
        - graphviz
        - nautilus
        - transmission
        - vinagre # vnc
        - vlc

        # UI
        - numix-gtk-theme # for xfce4-notifyd
        - ttf-mscorefonts-installer
        - ttf-ubuntu-font-family
        - xcursor-themes
        - xubuntu-icon-theme
        - adwaita-icon-theme

- name: X
  hosts: all
  tasks:
    # - name: XOrg config
    #   action: copy
    #   become: yes
    #   args:
    #     src: files/usr/share/X11/xorg.conf.d/100-compositing.conf
    #     dest: /usr/share/X11/xorg.conf.d/100-compositing.conf
    - name: X defaults
      action: copy
      args:
        dest: ~/.Xdefaults
        content: |
          URxvt.depth: 32
          URxvt*background: rgba:0000/0000/0000/cccc
          Xcursor.size: 24
    - action: copy
      become: yes
      args:
        dest: /etc/udev/rules.d/70-drm_event.rules
        content: |
          KERNEL=="card0", SUBSYSTEM=="drm", RUN+="/home/tjarvstrand/bin/udev_drm_event"
    - action: service
      become: yes
      args:
        name: udev
        state: restarted

- name: qtile
  hosts: all
  become: yes
  tasks:
    - action: apt
      args:
        name: "{{item}}"
      with_items:
        - aptitude # for update checking
        - libffi-dev
        - libiw-dev
        - libxcb-cursor0
        - libxcb-cursor-dev
        - libxcb-render0-dev
        - libpangocairo-1.0-0
        - python-dbus
    - action: pip
      args:
        name: "{{item}}"
      with_items:
        - xcffib
        - cairocffi
        - trollius
        - iwlib
        - qtile
        - sh
    - action: file
      args:
        state: directory
        dest: /usr/share/xsessions
    - action: copy
      args:
        dest: /usr/share/xsessions/qtile.desktop
        content: |
          [Desktop Entry]
          Encoding=UTF-8
          Name=qtile
          Comment=A full-featured, pure-Python tiling window manager
          TryExec=qtile
          Exec=qtile
          Type=Application
    - action: copy
      args:
        dest: /usr/share/lightdm/lightdm.conf.d/60-qtile.conf
        content: |
          [Seat:*]
          user-session=qtile

# - name: qtile hacking
#   hosts: all
#   tasks:
#     - action: apt
#       become: yes
#       args:
#         name: "{{item}}"
#       with_items:
#         - xserver-xephyr
#       action: pip
#       args:
#         name: "{{item}}"
#         virtualenv: "{{lookup('ENV', 'HOME')}}/.virtualenv"
#       with_items:
#         - cairocffi
#         - iwlib
#         - nose
#         - sh
#         - trollius
#         - xcffib
#         - python-mpd2
#         - google-api-python-client

- name: dmenu
  hosts: all
  vars:
    user_home: "{{ lookup('ENV', 'HOME') }}"
  tasks:
    - action: apt
      args:
        name: "{{item}}"
      with_items:
        - libxft-dev
        - libxft2
        - libxinerama-dev
    - action: git
      args:
        repo: http://git.suckless.org/dmenu
        dest: ~/src/dmenu
      ignore_errors: yes
    - shell: "make"
      args:
        chdir: "~/src/dmenu"
    - shell: "make install"
      become: yes
      args:
        chdir: "{{user_home}}/src/dmenu"

- name: Lightdm setup
  hosts: all
  tasks:
    - shell: xhost +SI:localuser:lightdm
      become: yes
    - shell: gsettings set com.canonical.unity-greeter draw-grid false
      become: yes
      become_user: lightdm

- name: Dropbox linking
  hosts: all
  tasks:
    - set_fact:
        dropbox_link_dirs:
          - Desktop
          - Documents
          - Pictures
          - .themes
          - .icons
    - action: file
      name: Delete directories
      args:
        state: absent
        dest: "~/{{item}}"
      with_items:
       - "{{dropbox_link_dirs}}"
    - action: file
      name: Create symlinks
      args:
        force: yes
        state: link
        src: "~/Dropbox/{{item}}"
        dest: "~/{{item}}"
      with_items:
       - "{{dropbox_link_dirs}}"

# - name: misc
#   hosts: all
#   tasks:
#     - shell: 'gsettings set org.gnome.desktop.interface gtk-theme "Vertex-Dark"'

# Local Variables:
# mode: yaml
# End:
