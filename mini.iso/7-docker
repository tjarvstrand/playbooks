---
- name: Docker
  hosts: all
  become: yes
  tasks:

    - action: apt
      name: Install lsb-core
      args:
        name:
          - lsb-core

    - shell: lsb_release -cs
      register: ubuntu_codename

    - action: apt_key
      name: Add docker apt keys
      args:
        url: https://download.docker.com/linux/ubuntu/gpg

    - action: apt_repository
      name: Add docker apt repositories
      args:
        repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ubuntu_codename.stdout}} stable"

    - action: apt
      name: Install docker-ce
      args:
        update_cache: yes
        name: docker-ce

    - action: user
      name: Add user to docker group
      args:
        user: "{{ lookup('env','USER') }}"
        group: docker
        append: yes

    - shell: uname -s
      register: uname_s
    - shell: uname -m
      register: uname_m
    - name: Get docker-compose
      action: get_url
      args:
        mode: +x
        dest: /usr/local/bin/docker-compose
        url: "https://github.com/docker/compose/releases/download/1.23.1/docker-compose-{{uname_s.stdout}}-{{uname_m.stdout}}"
      register: install_script

# Local Variables:
# mode: yaml
# End:
