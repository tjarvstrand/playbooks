---
- name: Configure Keyboard and mouse/touchpad
  hosts: all
  become: yes
  tasks:
    - action: copy
      name: Backup files
      args:
        backup: yes
        src: "{{item}}"
        dest: "{{item}}.bak"
      with_items:
        - /usr/share/X11/xkb/rules/evdev.lst
        - /usr/share/X11/xkb/rules/evdev.xml
    - action: copy
      name: Copy keyboard layout file
      args:
        src: files/usr/share/X11/xkb/symbols/custom
        dest: /usr/share/X11/xkb/symbols/custom
        backup: yes
    - action: lineinfile
      name: Set default keyboard layout
      args:
        dest: /etc/default/keyboard
        regexp: ^XKBLAYOUT
        line: XKBLAYOUT="custom,se"
    - action: lineinfile
      name: Set default keyboard layout variant
      args:
        dest: /etc/default/keyboard
        regexp: ^XKBVARIANT
        line: XKBVARIANT="us-sv-dvorak,"
    - action: lineinfile
      name: Set default keyboard layout options
      args:
        dest: /etc/default/keyboard
        regexp: ^XKBOPTIONS
        line: XKBOPTIONS="caps:ctrl_modifier"
    - shell: dpkg-reconfigure keyboard-configuration -p high
      name: Set default layout
    - script: scripts/add-evdev-xml /usr/share/X11/xkb/rules/evdev.xml
      name: Add xkb rules to evdev.xml
    - script: scripts/add-evdev-lst /usr/share/X11/xkb/rules/evdev.lst
      name: Add xkb rules to evdev.lst

    - action: lineinfile
      name: Set X mouse pointer size
      args:
        dest: /etc/X11/Xresources/x11-common
        regexp: "^Xcursor.size:.*"
        line: "Xcursor.size: 20"
    - shell: dconf write /org/gnome/desktop/interface/cursor-size 20
    - action: copy
      name: Create xorg.conf
      args:
        backup: yes
        dest: /etc/X11/xorg.conf
        content: >-
          Section "InputClass"
              Identifier "evdev keyboard catchall"
              Option "XkbLayout" "custom"
              Option "XkbVariant" "us-sv-dvorak"
              Option "kdbOption" "caps:ctrl_modifier"
              MatchIsKeyboard "on"
              MatchDevicePath "/dev/input/event*"
              Driver "evdev"
          EndSection


# Section "InputClass"
#     Identifier "touchpad catchall"
#     Driver "synaptics"
#     MatchIsTouchpad "on"
#     MatchDevicePath "/dev/input/event*"
#     #Option "LeftEdge" "123"
#     #Option "RightEdge" "2950"
#     #Option "TopEdge" "83"
#     #Option "BottomEdge" "1454"
#     Option "FingerLow" "6"
#     Option "FingerHigh" "10"
#     Option "MaxTapTime" "180"
#     Option "MaxTapMove" "151"
#     Option "MaxDoubleTapTime" "180"
#     Option "SingleTapTimeout" "180"
#     Option "ClickTime" "100"
#     Option "EmulateMidButtonTime" "75"
#     Option "EmulateTwoFingerMinZ" "71"
#     Option "EmulateTwoFingerMinW" "7"
#     Option "VertScrollDelta" "-111"
#     Option "HorizScrollDelta" "-111"
#     Option "VertEdgeScroll" "1"
#     Option "HorizEdgeScroll" "0"
#     Option "CornerCoasting" "0"
#     Option "VertTwoFingerScroll" "1"
#     Option "HorizTwoFingerScroll" "0"
#     Option "MinSpeed" "1"
#     Option "MaxSpeed" "1.75"
#     Option "AccelFactor" "0.0582581"
#     Option "TouchpadOff" "2"
#     Option "LockedDrags" "0"
#     Option "LockedDragTimeout" "5000"
#     Option "RTCornerButton" "2"
#     Option "RBCornerButton" "3"
#     Option "LTCornerButton" "0"
#     Option "LBCornerButton" "0"
#     Option "TapButton1" "1"
#     Option "TapButton2" "3"
#     Option "TapButton3" "0"
#     Option "ClickFinger1" "1"
#     Option "ClickFinger2" "1"
#     Option "ClickFinger3" "0"
#     Option "CircularScrolling" "0"
#     Option "CircScrollDelta" "0.1"
#     Option "CircScrollTrigger" "0"
#     Option "CircularPad" "0"
#     Option "PalmDetect" "0"
#     Option "PalmMinWidth" "10"
#     Option "PalmMinZ" "50"
#     Option "CoastingSpeed" "20"
#     Option "CoastingFriction" "50"
#     Option "PressureMotionMinZ" "7"
#     Option "PressureMotionMaxZ" "40"
#     Option "PressureMotionMinFactor" "1"
#     Option "PressureMotionMaxFactor" "1"
#     Option "ResolutionDetect" "1"
#     Option "GrabEventDevice" "0"
#     Option "TapAndDragGesture" "1"
#     Option "AreaLeftEdge" "0"
#     Option "AreaRightEdge" "0"
#     Option "AreaTopEdge" "0"
#     Option "AreaBottomEdge" "0"
#     Option "HorizHysteresis" "17"
#     Option "VertHysteresis" "17"
#     Option "ClickPad" "0"
# EndSection

# Local Variables:
# mode: yaml
# End:
