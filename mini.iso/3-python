---
- name: Configure virtualenv
  hosts: all
  tasks:
    - name: Install pip
      action: apt
      args:
        name: python-pip
      sudo: yes
    - name: Install virtualenv
      action: apt
      args:
        name: virtualenv
      sudo: yes
    - name: Install libffi
      action: apt
      args:
        name: libffi-dev
      sudo: yes
    - name: Setup virtualenv
      action: pip
      args:
        name: "{{item}}"
        virtualenv_site_packages: yes
        virtualenv: "{{lookup('ENV', 'HOME')}}/.virtualenv"
      with_items:
        - boto
        - PyYaml
        - keyring
        - requests
        - Jinja2
        - awscli
        - stashy
        - docker-compose
        - python-jenkins

        # Fix InsecurePlatformWarning in Python < 2.7.9
        - pyopenssl
        - ndg-httpsclient
        - pyasn1
    - shell: >
        . {{lookup('ENV', 'HOME')}}/.virtualenv/bin/activate && python -c 'from requests import certs; print certs.where()'
      register: ca_cert
    - action: file
      args:
        state: link
        force: true
        dest: "{{ca_cert.stdout}}"
        src: /usr/lib/ssl/certs/ca-certificates.crt
        follow: false

# Local Variables:
# mode: yaml
# End:
