---
- name: Docker
  hosts: all
  become: yes
  tasks:
    - action: apt
      name: Install lsb-core
      args:
        name: lsb-core
    - shell: lsb_release -a | grep Codename | cut -f 2
      register: ubuntu_codename
    - action: apt_repository
      name: Add apt repositories
      args:
        repo: "deb https://apt.dockerproject.org/repo ubuntu-{{ubuntu_codename.stdout}} main"
    - action: apt_key
      name: Add apt keys
      args:
        keyserver: hkp://p80.pool.sks-keyservers.net:80
        id: 58118E89F3A912897C070ADBF76221572C52609D
    - action: apt
      args:
        update_cache: yes
    - action: apt
      name: Install packages
      args:
        name: docker-engine
    - action: lineinfile
      name: Add Klarna dns to docker daemon
      args:
        dest: /etc/default/docker
        regexp: "^#?DOCKER_OPTS="
        line: DOCKER_OPTS="--dns 10.10.10.10"

# Local Variables:
# mode: yaml
# End:
