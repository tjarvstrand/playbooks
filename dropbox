---
- name: Install Dropbox
  hosts: all
  tasks:
    - shell: |
        cd ~ &&
        wget -q -O - "https://www.dropbox.com/download?plat=lnx.x86_64" | 
        tar xzf -
      name: Fetch and unpack
      args:
        creates: ~/.dropbox-dist
    - action: get_url
      name: Fetch Dropbox
      args:
        url: "https://www.dropbox.com/download?dl=packages/dropbox.py"
        dest: ~/bin/dropbox.py
        mode: 0755
    - command: ~/bin/dropbox.py start
      name: Start
      async: 3600
      poll: 0
    - command: ~/bin/dropbox.py autostart y
      name: Enable autostart
    - set_fact:
        dropbox_link_dirs:
          - doc
          - src
          - Desktop
          - Documents
          - Pictures
    - action: file
      name: Delete directories
      args:
        state: absent
        dest: "~/{{item}}"
      with_items:
       - "{{dropbox_link_dirs}}"
    - action: file
      name: Create symlinks
      args:
        force: yes
        state: link
        src: "~/Dropbox/{{item}}"
        dest: "~/{{item}}"
      with_items:
       - "{{dropbox_link_dirs}}"

# Local Variables:
# mode: yaml
# End: