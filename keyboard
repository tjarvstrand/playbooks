---
- name: Configure Keyboard
  hosts: all
  sudo: yes
  tasks:
    - action: copy
      name: Backup files
      args:
        backup: yes
        src: "{{item}}"
        dest: "{{item}}.bak"
      with_items:
        - /usr/share/X11/xkb/rules/evdev.lst
        - /usr/share/X11/xkb/rules/evdev.xml
    - action: copy
      name: Copy keyboard layout file
      args:
        src: files/usr/share/X11/xkb/symbols/custom
        dest: /usr/share/X11/xkb/symbols/custom
        backup: yes
    - action: lineinfile
      name: Set default keyboard layout
      args:
        dest: /etc/default/keyboard
        regexp: ^XKBLAYOUT
        line: XKBLAYOUT="custom,se"
    - action: lineinfile
      name: Set default keyboard layout variant
      args:
        dest: /etc/default/keyboard
        regexp: ^XKBVARIANT
        line: XKBVARIANT="us-sv-dvorak,"
    - action: lineinfile
      name: Set default keyboard layout options
      args:
        dest: /etc/default/keyboard
        regexp: ^XKBOPTIONS
        line: XKBOPTIONS="caps:ctrl_modifier"
    - shell: dpkg-reconfigure keyboard-configuration -p high
      name: Set default layout
    - script: scripts/add-evdev-xml /usr/share/X11/xkb/rules/evdev.xml
      name: Add xkb rules to evdev.xml
    - script: scripts/add-evdev-lst /usr/share/X11/xkb/rules/evdev.lst
      name: Add xkb rules to evdev.lst
    - action: copy
      name: Create xorg.conf
      args:
        dest: /etc/X11/xorg.conf
        content: >-
          Section "InputClass"
              Identifier "evdev keyboard catchall"
              Option "XkbLayout" "custom"
              Option "XkbVariant" "us-sv-dvorak"
              Option "kdbOption" "caps:ctrl_modifier"
              MatchIsKeyboard "on"
              MatchDevicePath "/dev/input/event*"
              Driver "evdev"
          EndSection
- name: Configure User Keyboard
  hosts: all
  tasks:
    - shell: gsettings set org.freedesktop.ibus.general.hotkey triggers []
      name: Disable ibus switcher triggers

# Local Variables:
# mode: yaml
# End:
